<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Tackling D8 Config Management</title>

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/solarized.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">

				<section>
					<h2>Tackling Config Management in Drupal 8</h2>
					<br />
					<p>By Zach Weishar</p>
				</section>

				<section>
					<strong>Configuration Management means taking control of your database in order to reliably manage change.</strong>
				</section>

				<section>
					<h3>What can config managment do for you?</h3>
					<section>
						<p>Traditionally, Drupal is composed of two parts:</p>
						<div style="float:left; margin-left: 25%;">
							<p>Code</p>
							<img data-src="img/code.svg" style="border:none;"/>
						</div>
						<div style="float:right; margin-right: 25%;">
							<p>Database</p>
							<img data-src="img/database-1.svg" style="border:none;"/>
						</div>
					</section>
					<section>
						<p>
							In order to effectivley manage change in your application,
							you need a way to control the state of both of these pieces.
						</p>
					</section>
					<section>
						<p>
							Managing change in code is relativley easy through the use of
							a version control system (VCS), such as GIT.
						</p>
					</section>
					<section>
						<p>
							Unfortunatley the same is not true for the database. This is where
							configuration mangment comes into play.
						</p>
					</section>
					<section>
						<p>
							Configuration managment allows you to control the state
							of your database by exporting its configuration to code which can be
							managed in your VCS of choice.
						</p>
					</section>
					<section>
						<strong>This is valuable because:</strong>
						<ul>
							<li>
								<p>You can easily deploy database updates between environments in the same way that you deploy code updates</p>
							</li>
							<li>
								<p>You never loose vital changes to your database because its history is managed by your VCS.</p>
							</li>
						</ul>
					</section>
					<section>
						<strong>If you're using config managment, you are essentially putting your database under version control!</strong>
						<br />
						<strong>(Not totally accurate, but pretty close)</strong>
					</section>
				</section>

				<section>
					<h3>Where we came from</h3>
					<section>
						<p>In Drupal 7, configuration management is made possible by contributed modules, namely features and strong arm</p>
					</section>
					<section>
						<strong>This solution has treated us well for years, but it has some shortcomings:</strong>
						<ul>
							<li>
								<p>
									It lives in the contrib space, which means there is no centralized API in core for module developers to
									expose their configuration. You can use either Entity API Exportables or Ctools Exportables.
								</p>
							</li>
							<li>
								<p>
									Features was designed to bundle up small chunks of descrete site functionality, not act as full
									configuration store for a complex site.
								</p>
							</li>
						</ul>
					</section>
					<section>
						<strong>Working with features can be frustrating:</strong>
						<ul>
							<li><p>Configuration often becomes spread between multiple features modules, which makes it hard to keep track of.</p></li>
							<li><p>Features modules can have interlocking dependencies, which can make changes harder down the road.</p></li>
							<li><p>Resolving merge conflicts in large features modules is tedious and error prone.</p></li>
						</ul>
					</section>
					<section>
						<strong>Drupal 8 addresses these issues:</strong>
						<ul>
							<li><p>There is a centralized configuration API in Drupal 8 core.</p></li>
							<li><p>All of you configuration now leaves cleanly in your configuration sync directory.</p></li>
							<li><p>Resolving merge conflicts is a lot easier because we have a bunch of small files instead of one large one, and the file format is yaml.</p></li>
						</ul>
					</section>
					<section>
						<strong>In Drupal 8 features is not dead, but now it is free to fulfill its original purpose!</strong>
					</section>
				</section>

				<section>
					<h3>What is considered configuration in Drupal 8?</h3>
					<section>
						<p>There are four main categories of data in Drupal 8</p>
					</section>
					<section>
						<strong>Content:</strong>
						<p>
							Information meant to be displayed on your site: articles, basic pages, images, files,
							custom blocks, etc. Content is stored and accessed using
							<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/group/entity_api/8.2.x">
								Content Entities.
							</a>
						</p>
					</section>
					<section>
						<strong>State:</strong>
						<p>
							Information of a temporary nature, generally machine-generated and not human-edited, about the current state of
							your site.
						</p>
						<p>Examples: the time when cron was last run or whether node access permissions need rebuilding.</p>
					</section>
					<section>
						<strong>It's state when:</strong>
						<ul>
							<li><p>The data is specific to an individual environment.</p></li>
							<li><p>You will never want to deploy it between environments.</p></li>
							<li><p>When you reset a system, you lose all state, but configuration persists.</p></li>
						</ul>
					</section>
					<section>
						<strong>Session:</strong>
						<p>
							Information about individual users' interactions with the site, such as whether they are logged in. This is really
							"state" information, but it is not stored the same way so it's a separate type.
						</p>
					</section>
					<section>
						<strong>Configuration:</strong>
						<p>
							Information about your site that is generally (or at least can be) human-edited, but is not content, and is
							meant to be relatively permanent.
						</p>
						<p>Examples: the name of your site, the content types and views you have defined.</p>
					</section>
				</section>

				

				<section>
					<h3>Things you should know about the CMS</h3>

					<section>
						<ul>
							<li>
								<p>
									The CMS is designed to move configuration between different instances of the same site, not between two
									separate sites.
								</p>
							</li>
							<li>
								<p>
									What this means is that you need to set up new environments from a database dump. An example
									would be starting your dev site from scratch, then creating both test and live sites from dumps of the dev
									database. This ensures the sites UUID's will match.
								</p>
							</li>
						</ul>
					</section>
					<section>
						<strong>Configuration stores</strong>
						<ul>
							<li>
								<p>The active configuration store is the one that is currently in use. When you first install Drupal, this is the database.</p>
							</li>
							<li>
								<p>When you export your configuration, you're exporting settings in the database to the file system, or from one store to another.</p>
							</li>
							<li>
								<p>The active configuration store is configurable, letting you swap it out as needed for other backends like Redis or MongoDB.</p>
							</li>
						</ul>
					</section>
					<section>
						<strong>There are two types of configuration:</strong>
						<ul>
							<li>
								<p>Simple: Used to store data that will only ever have one copy or version, like your site name.</p>
							</li>
							<li>
								<p>
									Configuration Entities: Used to store more complex data. There can be many instances of a single configuration
									entity. Some examples are views, content types, and image styles.
								</p>
							</li>
						</ul>
					</section>

					<section>
						<strong>Sites own configuration, not modules</strong>
						<ul>
							<li>
								<p>
									Modules and themes can provide default configuration that is imported when they are first installed. This is found in a
									a module's config/install or config/optional directory.
								</p>
							</li>
						</ul>
					</section>
					<section>
						<strong>Sites own configuration, not modules</strong>
						<ul>
							<li>
								<p>
									Updates to the files in the config/install or config/optional directories will have no affect on modules that are already
									installed on your site because the site owns the configuration, not the module.
								</p>
							</li>
							<li>
								<p>
									In order to update default config for a pre-installed module, you need to make the changes in a update hook (or uninstall / reinstall the module).
								</p>
							</li>
						</ul>
					</section>

					<section>
						<p>
							In Drupal 7, all variables were global (think vset and vget), which means that they were loaded into memory on every page load.
							In Drupal 8, these variables are only loaded into memory when they are needed.
						</p>
					</section>

				</section>

				<section>

					<h3>CMS Tips</h3>
					<section>
						<ul>
							<li>
								<p>By default, your active configuration is overwritten with the data in your file system when you import configuration. This is destructive.</p>
							</li>
							<li>
								<p>If you only want to import new configs and not delete untracked ones: <pre><code>drush config-import --partial</code></pre></p>
							</li>
							<li><p>To skip exporting configuration from certain modules (such as devel) use: <pre><code>drush config-export --skip-modules=devel</code></pre></li></p></li>
						</ul>
					</section>
					<section>
						<p>
							By default, Drupal sets up a configuration sync folder at a path like sites/default/files/config_really-long-uuid on install, but you can change the location
							by overriding it in settings.php
						</p>
						<pre>
							<code>$config_directories = array(CONFIG_SYNC_DIRECTORY => '../config/sync');</code>
						</pre>
					</section>
					<section>
						<p>Don't blindly trust the config system. It's still a good idea to review your exports before committing importing.</p>
					</section>

				</section>

				<section>
					<h3>Useful configuration related modules</h3>
					<ul>
						<li><a href="https://www.drupal.org/project/config_update">Configuration Update Manager</a></li>
						<li><a href="https://www.drupal.org/project/config_tools">Configuration Tools</a></li>
						<li><a href="https://www.drupal.org/project/config_sync">Configuration Synchronizer</a></li>
						<li><a href="https://www.drupal.org/project/config_devel">Configuration Development</a></li>
						<li><a href="https://www.drupal.org/project/config_readonly">Configuration Read Only</a></li>
						<li><a href="https://www.drupal.org/project/config_installer">Configuration Installer</a></li>
					</ul>
				</section>

				<section>
					<h3>Sources</h3>
					<section>
						<ul>
							<li><a href="https://www.lullabot.com/articles/configuration-management-in-drupal-8-the-key-concepts">Key Concepts of config system</a></li>
							<li><a href="https://www.drupal.org/node/1667894">Config API Overview</a></li>
							<li><a href="https://www.drupal.org/docs/8/configuration-management/managing-your-sites-configuration">Managing Your Site’s Configuration</a></li>
							<li><a href="https://www.lullabot.com/podcasts/drupalizeme-podcast/the-new-drupal-8-configuration-system">The New Drupal 8 Configuration System</a></li>
							<li><a href="https://api.drupal.org/api/drupal/core%21core.api.php/group/config_api/8.2.x">Configuration API overview page</a></li>
							<li><a href="https://groups.drupal.org/node/191283">Config Management architecture (this is pretty out of date, but still useful)</a></li>
						</ul>
					</section>
					<section>
						<ul>
							<li><a href="https://www.phase2technology.com/blog/using-and-abusing-the-configuration-management-module-for-drupal-7/">Using and abusing the configuration management system</a></li>
							<li><a href="https://events.drupal.org/neworleans2016/sessions/drupal-8-features-vs-configuration-management">Config managment vs features session</a></li>
							<li><a href="https://www.drupal.org/node/1905070">Configuration Cheat Sheat</a></li>
							<li><a href="https://www.drupal.org/node/1809490">Simple config api</a></li>
							<li><a href="https://www.drupal.org/docs/8/creating-custom-modules/include-default-configuration-in-your-drupal-8-module">Default module configuration</a></li>
						</ul>
					</section>
				</section>



			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			// More info https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				history: true,

				// More info https://github.com/hakimel/reveal.js#dependencies
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});
		</script>
	</body>
</html>
